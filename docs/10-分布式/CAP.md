## CAP

> 在一个分布式系统(互相连接并共享数据的节点集合)中，当涉及读写操作时，只能保证一致性、可用性、分区容错性三者中的两个，另一个必须被牺牲

### 分布式带来的问题

* 分布式架构
    * 主从
    * 读写分离
* 节点间的数据同步
    * 主从同步

### 一致性

> Consistency，所有节点上的数据是一致的

### 可用性

> Availability，可对外提供服务

### 分区容错性

> Partition Tolerance

`分区`: 整个网络分为几块区域，相互之间不连通，包括节点宕机和网络异常

<p style="text-align: center;"><img src="_media/distribution/cap.jpg" alt="CAP" style="width: 50%"></p>

* `单节点`: 可以同时满足一致性和可用性(`CA`)，但无法避免单点故障
* `多节点`: 数据在多个节点之间同步，每个节点都可对外提供服务
    * `未发生分区`
        * 保证一致性(`CP`): 数据同步复制到所有节点，降低了可用性
        * 保证可用性(`AP`): 数据异步复制到所有节点，可能导致数据不一致
    * `发生分区`: 节点之间无法正常同步数据，这时，就必须做一个艰难的选择
        * 保证一致性牺牲可用性(`CP`): 为保证所有节点上的数据是一致的，节点必须暂停对外提供写服务
        * 保证可用性牺牲一致性(`AP`): 为保证节点继续对外提供服务，忽略数据同步上的失败，但会导致节点之间的数据不一致

分布式系统无法放弃分区容错性，只能在可用性和一致性之间取舍，一般通过牺牲`强一致性`来换取系统的`高可用性`，保证`最终一致性`即可


[<< 上一篇: 读写分离](9-数据库/读写分离.md)

[>> 下一篇: RPC](10-分布式/RPC.md)
